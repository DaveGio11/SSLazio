@model IEnumerable<SSLazio.Models.Prodotti>

@{
    ViewBag.Title = "Index";
}

@{
    var cart = Session["cart"] as List<SSLazio.Models.Prodotti>;
    var cartItemCount = cart?.Sum(item => item.Quantita) ?? 0;
}

<link href="~/Content/Site.css" rel="stylesheet" />



<h2>Index</h2>

<div class="mt-3">
    @if (User.IsInRole("Admin"))
    {
        <button class="ssl-button mb-3 d-flex justify-content-center">
            @Html.ActionLink("Create New", "Create", null, new { @class = "text-white text-decoration-none" })
        </button>
    }
</div>






<div class="container-fluid">
    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3 my-4 d-flex justify-content-center">
                <div>
                    @using (Html.BeginForm("AddToCart", "Prodotti", FormMethod.Post, new { @class = "d-inline" }))
                    {
                        @Html.Hidden("id", item.IdProdotto)
                        <div class="book" style="background-color: #cbc094">
                            <img src="@Url.Content("~/Content/Negozio/" + item.Immagine)" alt="prodotto" style="width: 100%; height: 100%; object-fit: cover;" class="rounded" />
                            <div class="cover">
                                <img src="@Url.Content("~/Content/Negozio/" + item.Immagine2)" alt="prodotto" style="width: 100%; height: 100%; object-fit: cover;" class="rounded" />
                            </div>
                        </div>
                        <p class="mt-3">@item.NomeProdotto</p>
                        <div class="d-flex discountPremium">
                            <p class="card-text">
                                <strong>£: @item.Prezzo.ToString("F2") &nbsp; </strong>
                                <label for="Quantita_@item.IdProdotto" class="form-label fw-bold me-1">Qta:</label>
                                <!-- Imposta il valore massimo dell'input sulla quantità disponibile del prodotto -->
                                <input id="Quantita_@item.IdProdotto" type="number" name="quantita" value="1" min="1" max="@item.Quantita" class="form-control w-auto d-inline" style="width: 50px;" />
                            </p>
                        </div>
                        <div>
                            @if (item.Quantita == 0)
                            {
                                <p class="card-text"><strong>Product not available</strong></p>
                                <div class="my-2 d-flex">
                                    <input type="submit" value="Esaurito" class="ssl-button text-danger me-2" disabled />
                                    <button class="ssl-button text-white shadow">
                                        <a href="@Url.Action("Details", new { id = item.IdProdotto })" class="text-white text-decoration-none" style="text-decoration: none;">
                                            Dettagli
                                        </a>
                                    </button>
                                </div>
                            }
                            else
                            {
                                <p class="card-text"><strong>Available: @item.Quantita</strong></p>
                                <div class="my-2 d-flex">
                                    <input type="submit" value="Add to Cart" class="ssl-button me-2" />
                                    <button class="ssl-button text-white shadow">
                                        <a href="@Url.Action("Details", new { id = item.IdProdotto })" class="text-white text-decoration-none" style="text-decoration: none;">
                                            Dettagli
                                        </a>
                                    </button>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>


